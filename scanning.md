# SCANNING

This stage is the first to use the RECON information and it prepares everything for the next one (TESTING) where vulnerabilities are exploited if necessary. Therefore, this stage starts by searching for exposed services in the targets within the scope (for this stage, the hosts are already defined as targets of the attacks that start by searching for vulnerabilities).

Then, the software that supports the services found is identified and the search for vulnerabilities begins, which can be based, initially, on using public databases regarding the banners obtained and even using automated vulnerability scanning tools. Manual confirmation is required as much as possible or at least defining the conditions for exploiting vulnerabilities in the next stage (aspects such as possible DoS, account blocking, version/time contexts, etc.)

Since this stage begins with more intrusive actions that generate easily detectable traffic, it is important to take into consideration the need to bypass the protection established in the evaluated organization from simple firewalls to preventers and the rest of the defense paraphernalia that has been established. The obligation of a pentest to evade such protections varies according to the scope and the assigned time that must have been accepted by mutual agreement. However, at least the report should document the efforts to evade the protections even if they were useless. Also, it is feasible that exceptions are proposed and privileged access is granted. This is not highly recommended in infrastructure tests and is almost always included in application tests (privileged or credential tests or post-authentication tests).

## VULNERABILITY IDENTIFICATION

Identification starts by looking for open ports on targets. Other types of status can be complementary. For example, knowing which ports are filtered can help confirm some protection between pentesters and targets (which should be treated as explained above). TCP scans are the most relevant, and UDP scans towards well-known ports used by DNS, SNMP and VoIP. The best approach to port scanning is to conduct it from less to more because it should recognize sensitive equipment (it should have been identified before starting any action and during pentest planning, but, in the real world...) and the protections that could hinder the task. For example, recognizing the blocking of an IPS early will help to carry out an early evasion process, especially at the port scanning stage, because IPSs usually do not implement this type of protection and if they are active, they are by default (detection and blocking thresholds can be identified).

The identification of the software that uses a certain port should be done through the initial handshake at least (as NMAP does, for example), but rarely has the software banner been modified. In any case, it is the pentest's obligation to confirm the exact software used in the exposed service. In the case that there is no tool that can identify it and only unknown "signatures" are obtained, at least one should search on the Internet for these signatures, the ports/protocols that are being used, and try to fuzz the service in a basic way.
Once the services have been identified, the natural step is to use automated vulnerability scanning tools. Nowadays, the emission of false positives by the tools is close to zero. Only a poor configuration or a huge lack of knowledge of how to conduct a pentest could lead to considering a result as a false positive. Then, the configuration of the scanning profiles and the interpretation of the results become the most important actions. A scanner will not serve to chain vulnerabilities or interpret the context of a result it has obtained.

## ATTACK VECTOR DESIGN

With all the information obtained, a list of possible vulnerability exploitation actions should be drawn up, which may have various levels. From those that can be used to penetrate an internal network from the Internet or access an unauthorized network segment or exfiltrate information or bypass an authentication control or allow an injection or access to an unauthorized function or commit fraud to those that seem merely informative (which should be classified as stories).

Some examples of vulnerabilities may seem trivial or whose exploitation has been relegated to the academic field (true research that is not carried out in the real world). The use of obsolete versions of software or protocols can lead the evaluated organization to fail to comply with the requirements of a particular audit (such as those of PCI DSS). Regardless of whether they are considered exploitable or not, they must be reported. The lack of a public exploit or a documented technique to exploit a vulnerability does not imply that it cannot be exploited, either because an exploit or a technique exists and none of them are public. Risk rating is not feasible under these conditions and therefore must be classified as complementary information for the pentest.

Cases of partially exploited vulnerabilities must be considered, especially when "chain vulnerabilities" are becoming increasingly common. The design of the attack vector must consider the specification of the partial results and their interpretation because this will allow for proper reporting and rating.
Also, the criteria for considering a successful exploitation must be established for the exploitation actions that will be proposed for the next stage. Again, this depends greatly on the scope, time and context of the pentest. In fact, it is feasible that at this point vulnerabilities have been found that do not correspond to the scope of the pentest, but they must be reported. For example, during an internal pentest of a set of objectives specified by the evaluated organization, using internal DNS servers to perform an exfiltration action or establishing a jump box that is accessed without control must be reported.

Vulnerability identification involves obtaining information about some exploitation technique or the existence of a program to exploit it or creating an attack strategy during the pentest.

It also involves recognizing when a vulnerability is applicable to the targets in scope. For example, identifying an SSH vulnerability based on the banner obtained from an SSH server, but which is valid for the SSH client of that same version, may not be relevant as long as it is not in the scope of SSH clients.

## VULNERABILITY CONFIRMATION

A pentest has the obligation to report exploited vulnerabilities or those for which a valid PoC has been obtained. The boundary between confirming and exploiting a vulnerability can be complex. There are vulnerability exploitation frameworks and exploitation programs (mainly PoC type) that have validation and non-exploitation options, but this is not the most common.

Vulnerabilities can be confirmed if more than one automated scanning tool delivers the same results, for example. This does not guarantee successful exploitation in any case, but it is the most logical and coherent thing that if two tools report the same thing, it must be valid.
In other cases, confirmation must be done "by hand" either by using general purpose tools or using specific programs (scripts) or creating them. A response type or a message or a particular error code can be confirmation of the existence of a vulnerability. A very hackneyed but useful example is given with SQL injections (yes, they still exist in 2022): in the case of visible or error message-based ones, they can be identified by using a single quote and obtaining a syntax error message. To check it, you can go further by listing other data (database in use, user account used, list of databases, etc.). The subsequent exploitation is what will allow us to know the real risk, that is, whether only information can be read (all, some) or also altered (or deleted) or interact with the underlying file system or interact with the underlying operating system, etc.

## ELEMENTS USED DURING SCANNING

### Port and Service Scanning

- NMAP
- Wireshark or tshark

**The following sections involve elements that are dependent on the findings. Therefore, only elements that have the ability to help in checking vulnerabilities in various types of targets (operating systems/base software/applications) are referenced. Similarly, in the case of applications, there will be various tools depending on the type of tests (DAST/SAST/IAST).**

### Automated vulnerability scanning

- NMAP
- Nessus
- Nuclei
- Burp
- In the case of websites (infrastructure) and web applications, searching for directories and files is important: Burp, gobuster, dirb, wfuzz, NMAP. Relying on SecLists.
- On MS Windows networks: Responder.py, crackmapexec, Impacket tools, Powersploit
- On mobiles: MobSF, Burp

### Confirmation

- NMAP
- Metasploit
- Burp
- MobSF
